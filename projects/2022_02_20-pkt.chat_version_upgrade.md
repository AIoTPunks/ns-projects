# Upgrade pkt.chat software

* Project Name: pkt.chat software version upgrade
* Contact Email: delivery [ a t ] marianne [ d o t ] io
* Project participants:
  * Thierry Marianne (@thierrymarianne in [pkt.chat](https://pkt.chat)) will work 100% of fulltime
* Projected duration: from 2 to 2.5 weeks 
to be put in perspective with 14 days required to have [v5.46.1 PR merged](https://github.com/thierrymarianne/contrib-matterfoss/pull/1) before excluding minor fixes like [restoring emojis](https://github.com/cjdelisle/MatterfossWeb/pull/4) or [replacing favicons](https://github.com/cjdelisle/MatterfossWeb/pull/6)) and also 
by including optional post-release maintenance hours / days (the last half-week)
* Projected effort: 1 person/week
* Pre-project effort: half a day involving 2 person: @cjd as pkt.chat hosting provider and I
* Requested PKT contribution: 275K PKT
* PKT address to pay to: `pkt1qpcnlzcam8gcka4mrjwdlzdgkyngwazjrtan24n`

## Project summary

Matterfoss was [recently](https://github.com/cjdelisle/Matterfoss/commit/b61323db6e7de9344db8ac7bf566bd48dba13540) upgraded to support native mobile applications compatible with Mattermost™ v5.46.1 tag.  

Given than more recent iOS and Android mobile applications versions have been rolled out to further support latest stable versions of [Mattermost™ upstream server-side API project](https://github.com/mattermost/mattermost-server/releases/tag/v6.4.0) (v6.4.0 being the latest major version at the moment),  
and to prevent being reminded of the pending intermediate software upgrades   
for each and every time the latest version available of the native app is opened,  
integrating upstream changes into Matterfoss makes sense. 

Please see below a screenshot of the warning message being displayed for Android:

![unsupported-software](https://user-images.githubusercontent.com/1053622/154851334-31799dbc-17c5-4f19-ab03-4964fce14424.png)

## Team and Past Work

As an independant solo contractor, I have worked in the service of PKT ecosystem before,  
especially in the context of the [European LEDGER project](https://www.ngi.eu/ngi-projects/ledger/) with [SafePKT](https://ledgerproject.github.io/home/#/teams/SafePKT) developments.

Besides having worked on the Matterfoss instance hosted at https://pkt.chat in the past,  
this project would present relatively few unknowns  

## Project deliverables

* [ ] New open source software
    * Which license(s) which you will use:
      * [ ] [GPL-3.0-or-later](https://spdx.org/licenses/GPL-3.0-or-later.html)
      * [ ] [MIT](https://spdx.org/licenses/MIT.html)
      * [ ] [GPL-2.0-only](https://spdx.org/licenses/GPL-2.0-only.html)
      * If your license(s) is/are not shown, please add them using the [SPDX license list](https://spdx.org/licenses/)
    * The maintainer of this software will be: *project participant*
    * The software will be hosted in: *software repository location*
* [x] Contributions to existing software
  * List software projects
    * [ ] [cjdns](https://github.com/cjdelisle/cjdns)
    * [ ] [yggdrasil-go](https://github.com/yggdrasil-network/yggdrasil-go)
    * [ ] [PacketCrypt](https://github.com/cjdelisle/PacketCrypt)
    * [ ] [pktd](https://github.com/pkt-cash/pktd)
    * [x] [Matterfoss API](https://github.com/cjdelisle/Matterfoss)
    * [x] [Matterfoss Single-Page Application (SPA)](https://github.com/cjdelisle/MatterfossWeb)
* [x] Other deliverables
    * [x] Active support during version migration in production
    * [x] Hotfix implementations

Matterfoss has become one of [PKT ecosystem communication pillars](https://pkt.cash/community) in the shape of an instance hosted at https://pkt.chat when it comes to 
 - bringing support to newcomers and also, 
 - streamlining project organization.

Since this platform serves as a host for a significant portion of all community-dependent operations, and innovations happening at the heart of PKT project and responding to its long-term vision, I'd argue that the tools offered to community members should be of pristine quality,  
hence the need for a software upgrade policy consistent with industrial standards.

As PKT project lead @cjd stated himself in [The Tao of Information Security](https://youtu.be/ek2bGVBdeBs) video:
[...] "you may fall victim to vulnerabilities that everybody already know about" [...] without making a consistent habit of [updating software](https://www.youtube.com/watch?v=ek2bGVBdeBs&t=1s).

## Success criteria

The most critical and final evaluation criteria is the release of those changes in production (and pkt.chat instance services recycling). 

Such release in production will be fairly easy to validate by having the Android client application not displaying anymore the unsupported version message previously attached to this proposal until the next major version of Mattermost™ incompatible with its native mobile apps is released.

## Milestones

 1. Define which tags will need to be targeted for integration from upstream projects during kickoff 
 2. Upgrade [Matterfoss API](https://github.com/cjdelisle/Matterfoss) 
 3. Replace favicons to accommodate to software licencing differences.
 See this past [issue](https://github.com/cjdelisle/MatterfossWeb/pull/6)
 4. Generate emoji fonts and matching images along with static files.
 See this past [issue](https://github.com/cjdelisle/MatterfossWeb/pull/4)
 5. Communicate upfront to community members about upcoming maintenance mode with minimal disturbance affecting their discussions
 6. Recycle Matterfoss API service 
 7. Communicate to community members regarding likely requirement for hard-refresh of https://pkt.chat pages possibly cached by their browser 
 8. Replace Matterfoss SPA static files re-exported since latest merge in production before recycling web server
 9. (Optional) Offer support to project maintainer up to half a week worth of post-release maintenance (hourly billed)

### Milestone 1 (Kickoff)

Upon agreement during the kickoff meeting regarding tagged versions to be targeted for integration from upstream,  
1/10 of the total project PKT contribution (27.5K PKT) will be provided. 

### Milestone 2

#### Success criteria

A pull-request being merged into Matterfoss API repository and/or commits have been added to its main branch so that the server-side API becomes ready for testing with the SPA software and future deployment in production

#### Payout

After a report is delivered on this milestone and it is approved by the NS, the NS will send 3/20 of the total project PKT contribution (41.25K PKT)

### Milestone 3

A pull-request has been merged into Matterfoss SPA repository and/or commits have been added to its main branch so that the client-side application becomes ready for testing with the API software and future deployment in production.

#### Payout

After a report is delivered on this milestone and it is approved by the NS, the NS will send 3/20 of the total PKT contribution (41.25K PKT)

### Milestone 3

All favicons are ready to be served.  
Special cases exist for macos and iOS native app applications, we might need to go back and forth with testing in staging environment.

#### Payout

After a report is delivered on this milestone and it is approved by the NS, the NS will send 1/20 of the total PKT contribution (13.75K PKT).

### Milestone 4

Emoji fonts and images have been generated and are ready to be served.  
There is a ruby script requiring specific libraries from a linux system to be installed in order to generate these assets. 

See this [pull-request description](https://github.com/cjdelisle/MatterfossWeb/pull/2).

Both API and SPA are affected by [system emojis generation](https://github.com/cjdelisle/Matterfoss/pull/5/files).

#### Payout

After a report is delivered on this milestone and it is approved by the NS, the NS will send 1/20 of the total PKT contribution (13.75K PKT).

### Milestones 5 to 8

Even though those last milestones are the most critical ones since they are all about releasing to production the software changes, there is no way for me to implement them on my own for privacy reason towards community members by accessing services to be recycled or their logs in case of unforeseen incident occurring in production.

That's why migrations for both API and SPA will need to be conducted with full collaboration between @cjd, who is responsible for hosting pkt.chat as far as I know and myself so that we could deploy potential hotfixes.

Both release dates will need to be defined at the time of the kickoff so that we can schedule all necessary communication as soon as possible.

#### Payout

After a report is delivered on this milestone and it is approved by the NS, the NS will send 3/10 of the total PKT contribution (82.5K PKT).

### Milestones 9 (optional)

Hotfixes and additional patches could be applied and prepared for deployment in production on a hourly basis up to the pre-provisioned budget.

#### Payout

After a report is delivered on this milestone and it is approved by the NS, the NS will send 1/5 of the total PKT contribution (55K PKT) or 3.14K PKT / hour.

## Disclosure

I hereby submit this application in good faith and I attest that I have made no effort, nor do I intend to make effort, influence the Network Steward to accept this or any other project I have
submitted.

*Please check one or more:*

1. Conflicts
  1. [ ] An organization is receiving the funds
    1. [ ] Organization has financial relationships with one or more reviewers: *specify whom*
    2. [ ] Organization has no financial relationships with any reviewers
  2. [x] An individual is receiving the funds
    1. [ ] Individual works for same organization as one or more reviewers: *specify whom*
    2. [x] Individual has other financial relationships with one or more reviewers: @cjd (I used to be an employee of CJDNS SASU)
    3. [x] Individual does not work for the same organization as any reviewer
2. No Pumping
  1. [ ] Project results will present information which might lead to PKT price speculation
    * If selected, please attach a paragraph detailing the information which will be presented and any steps which will be taken to prevent this from potentially misleading the public.
  2. [x] Project results will not present information which might lead to PKT price speculation

## Use of Resources

Each milestone report will be accompanied by:

* [x] Itemization of project expenditures, including description, date and price (in national currency)
  * [ ] Justification of this itemization in an audit certificate
* [x] Dates when PKT was converted to national currency
  * [ ] Justification of this conversion in an audit certificate
* [ ] An audit certificate from a qualified financial auditor
  * *If yes, please provide name of the auditor*: ___________

### Partial milestones

If it happens that I have satisfied all of the criteria for a milestone but have not provided justification of all resources allocated:

* [x] I will deduct the un-justified amount from the amount requested for the milestone
* [ ] I will request the milestone be paid in full anyway

## Legal

The applicant understands that the network steward is not a legal entity and no part of this
project constitutes any form of legal agreement. The applicant accepts that the network steward
exists thanks to the effort of volunteers and the applicant has no reasonable expectation of any
action, payment or communication from the network steward at any time. For their part, the
applicant has no binding commitment or obligation at any time as a result of their participation
in this project.

## Project Status

 - guidance requested (especially regarding Use of Resources section)
